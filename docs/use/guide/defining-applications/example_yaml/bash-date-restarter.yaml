name: vanilla-bash-date-restarter
location: localhost
services:
- type: brooklyn.entity.basic.VanillaSoftwareProcess
  name: Date1
  launch.command: |
    echo utc `date +%s` > DATE
    echo human `date` >> DATE
    nohup sleep 60 &
    echo $! > $PID_FILE
    sleep 3
  brooklyn.policies:
  - policyType: brooklyn.policy.ha.ServiceFailureDetector
    brooklyn.config:
      # only count it failed if it has been down for 10s
      serviceFailedStabilizationDelay: 10s
  - policyType: brooklyn.policy.ha.ServiceRestarter
    brooklyn.config:
      # by default, 2 failures w/in 3m will cause it to give up;
      # let's lower that limit so it restarts continually! 
      failOnRecurringFailuresInThisDuration: 30s
